<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ccairbag.api.mapper.CcairbagNegotiationRecordMapper">
    
    <resultMap type="CcairbagNegotiationRecord" id="CcairbagNegotiationRecordResult">
        <result property="id"    column="id"    />
        <result property="productId"    column="product_id"    />
        <result property="buyerId"    column="buyer_id"    />
        <result property="shopId"    column="shop_id"    />
        <result property="offerPrice"    column="offer_price"    />
        <result property="status"    column="status"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateTime"    column="update_time"    />
        <result property="negotiationCount"    column="negotiationCount"    />
        <result property="remarks"    column="remarks"    />


    </resultMap>

    <sql id="selectCcairbagNegotiationRecordVo">
        select id, product_id, buyer_id, shop_id,negotiationCount,remarks, offer_price, status, create_time, update_time from ccairbag_negotiation_record
    </sql>

    <select id="selectCcairbagNegotiationRecordList" parameterType="CcairbagNegotiationRecord" resultMap="CcairbagNegotiationRecordResult">
        <include refid="selectCcairbagNegotiationRecordVo"/>
        <where>
            <if test="productId != null "> and product_id = #{productId}</if>
            <if test="buyerId != null "> and buyer_id = #{buyerId}</if>
            <if test="shopId != null "> and shop_id = #{shopId}</if>
            <if test="offerPrice != null "> and offer_price = #{offerPrice}</if>
            <if test="status != null "> and status = #{status}</if>
        </where>
    </select>
    
    <select id="selectCcairbagNegotiationRecordById" parameterType="Long" resultMap="CcairbagNegotiationRecordResult">
        <include refid="selectCcairbagNegotiationRecordVo"/>
        where id = #{id}
    </select>

    <select id="checkNegotiableMoney"  resultType="Integer">
        select count(1) from ccairbag_negotiation_record
        where  buyer_id = #{buyerId}
          AND product_id = #{productId}
        and status = 0
    </select>

    <select id="listNegotiableMoney" parameterType="Long" resultType="com.ruoyi.system.api.domain.ccairbag.dto.CcairbagNegotiationRecordDTO">
        select a.id,a.product_id productId,a.buyer_id buyerId,a.shop_id shopId,a.remarks,
               a.offer_price offerPrice,a.`status` status,a.negotiationCount,
               b.product_name productName,b.ori_price oriPrice,b.price,b.pic,b.imgs
        from ccairbag_negotiation_record a,ccairbag_products b
        where  a.shop_id = #{shopId} and b.product_id=a.product_id
        order by a.create_time desc
    </select>

    <select id="buyerListNegotiableMoney" parameterType="Long" resultType="com.ruoyi.system.api.domain.ccairbag.dto.CcairbagNegotiationRecordDTO">
        select a.id,a.product_id productId,a.buyer_id buyerId,a.shop_id shopId,a.remarks,
               a.offer_price offerPrice,a.`status` status,a.negotiationCount,c.shop_name shopName,
               b.product_name productName,b.ori_price oriPrice,b.price,b.pic,b.imgs
        from ccairbag_negotiation_record a,ccairbag_products b,ccairbag_shops  c
        where  a.buyer_id = #{buyerId} and b.product_id=a.product_id
        and c.shop_id=a.shop_id and c.`application_status`=1
        order by a.create_time desc
    </select>



    <insert id="insertCcairbagNegotiationRecord" parameterType="CcairbagNegotiationRecord" useGeneratedKeys="true" keyProperty="id">
        insert into ccairbag_negotiation_record
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="productId != null">product_id,</if>
            <if test="buyerId != null">buyer_id,</if>
            <if test="shopId != null">shop_id,</if>
            <if test="offerPrice != null">offer_price,</if>
            <if test="status != null">status,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="negotiationCount != null">negotiationCount,</if>
            <if test="remarks != null  and remarks != ''"> remarks,</if>


            </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="productId != null">#{productId},</if>
            <if test="buyerId != null">#{buyerId},</if>
            <if test="shopId != null">#{shopId},</if>
            <if test="offerPrice != null">#{offerPrice},</if>
            <if test="status != null">#{status},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="negotiationCount != null">#{negotiationCount},</if>
            <if test="remarks != null  and remarks != ''"> #{remarks},</if>


        </trim>
    </insert>

    <update id="updateCcairbagNegotiationRecord" parameterType="CcairbagNegotiationRecord">
        update ccairbag_negotiation_record
        <trim prefix="SET" suffixOverrides=",">
            <if test="productId != null">product_id = #{productId},</if>
            <if test="buyerId != null">buyer_id = #{buyerId},</if>
            <if test="shopId != null">shop_id = #{shopId},</if>
            <if test="offerPrice != null">offer_price = #{offerPrice},</if>
            <if test="status != null">status = #{status},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="negotiationCount != null">negotiationCount = #{negotiationCount},</if>
            <if test="remarks != null  and remarks != ''">  remarks = #{remarks},</if>


        </trim>
        where id = #{id}
    </update>

    <delete id="deleteCcairbagNegotiationRecordById" parameterType="Long">
        delete from ccairbag_negotiation_record  where id = #{id}
    </delete>

    <delete id="deleteCcairbagNegotiationRecordByIds" parameterType="String">
        delete from  ccairbag_negotiation_record  where id in
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>

    </delete>
</mapper>